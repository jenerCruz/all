  <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistencias PRO</title>
    <meta name="theme-color" content="#2563eb" />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tesseract (Opcional, si no lo tienes no pasa nada) -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

    <!-- Manifest -->
    <link rel="manifest" href="./manifest.json" />
</head>

<body class="bg-gray-100 text-gray-800">

    <!-- NAV BAR -->
    <nav class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-xl font-bold">Asistencias PRO</h1>
        <button onclick="toggleMenu()" class="md:hidden">☰</button>
        <ul id="menu" class="hidden md:flex gap-6">
            <li><button onclick="showSection('equipo')">Equipo</button></li>
            <li><button onclick="showSection('individual')">Individual</button></li>
            <li><button onclick="showSection('config')">Config</button></li>
        </ul>
    </nav>

    <!-- SECCIÓN EQUIPO -->
    <section id="equipo" class="p-4">
        <h2 class="text-xl font-bold mb-4">Asistencia por Equipo</h2>

        <div class="bg-white p-4 rounded-lg shadow mb-4">
            <label class="font-bold">Fecha:</label>
            <input id="team-date" type="date" class="w-full p-2 border rounded-lg mt-2" />
        </div>

        <!-- Aquí van tus tarjetas de equipo (no se modifican) -->
        <div class="grid grid-cols-1 gap-4">
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="font-bold">Registrar Entrada/Salida</h3>
                <button class="mt-2 bg-blue-600 text-white px-4 py-2 rounded">Registrar Entrada</button>
                <button class="mt-2 bg-green-600 text-white px-4 py-2 rounded">Registrar Salida</button>
            </div>
        </div>
    </section>

    <!-- SECCIÓN INDIVIDUAL -->
    <section id="individual" class="hidden p-4">
        <h2 class="text-xl font-bold mb-4">Asistencia Individual</h2>

        <!-- Selección de promotor -->
        <div class="bg-white p-4 rounded-lg shadow mb-4">
            <label class="font-bold">Promotor:</label>
            <select id="user-selector" class="w-full p-2 border rounded-lg mt-2" onchange="setActiveUser(this.value)">
                <option value="">Selecciona promotor</option>
                <option value="1">Promotor 1</option>
                <option value="2">Promotor 2</option>
                <option value="3">Promotor 3</option>
            </select>
        </div>

        <!-- Fecha -->
        <div class="bg-white p-4 rounded-lg shadow mb-4">
            <label class="font-bold">Fecha:</label>
            <input id="evidence-date" type="date" class="w-full p-2 border rounded-lg mt-2">
        </div>

        <!-- Botones Entrada/Salida -->
        <div class="bg-white p-4 rounded-lg shadow mb-4">
            <h3 class="font-bold mb-2">Evidencias</h3>

            <button id="fotoEntradaBtn" class="w-full bg-blue-600 text-white py-3 rounded-lg mb-3">
                Subir Foto Entrada
            </button>

            <div id="preview-entrada" class="w-full h-40 bg-gray-200 rounded-lg mb-4 flex items-center justify-center text-sm text-gray-600">
                Sin imagen
            </div>

            <button id="fotoSalidaBtn" class="w-full bg-green-600 text-white py-3 rounded-lg mb-3">
                Subir Foto Salida
            </button>

            <div id="preview-salida" class="w-full h-40 bg-gray-200 rounded-lg flex items-center justify-center text-sm text-gray-600">
                Sin imagen
            </div>

            <!-- INPUT FILE REAL (OCULTO) -->
            <input id="evidenciaInput" type="file" accept="image/*" style="display:none">
        </div>

        <!-- RESULTADO OCR -->
        <div class="bg-white p-4 rounded-lg shadow">
            <h3 class="font-bold mb-2">Resultado OCR</h3>
            <p id="resultadoOCR" class="text-gray-700">Aún sin procesar...</p>
        </div>
    </section>

    <!-- CONFIG -->
    <section id="config" class="hidden p-4">
        <h2 class="text-xl font-bold mb-4">Configuración & Sincronización</h2>

        <div class="bg-white p-4 rounded-lg shadow mb-4">
            <label class="font-bold">Gist ID</label>
            <input id="gist-id" class="w-full p-2 border rounded-lg mt-2">

            <label class="font-bold mt-4">Token</label>
            <input id="gist-token" class="w-full p-2 border rounded-lg mt-2">

            <button onclick="saveGistConfig()" class="mt-4 w-full bg-blue-600 text-white py-3 rounded-lg">
                Guardar Configuración
            </button>

            <button onclick="EvidenceModule.syncNow()" class="mt-4 w-full bg-green-600 text-white py-3 rounded-lg">
                Sincronizar Ahora
            </button>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="text-center py-3 text-gray-600">
        Asistencias PRO © 2025
    </footer>

    <!-- JS PRINCIPALES -->
    <script>
        function toggleMenu(){
            const menu = document.getElementById("menu");
            menu.classList.toggle("hidden");
        }

        function showSection(name){
            document.getElementById("equipo").classList.add("hidden");
            document.getElementById("individual").classList.add("hidden");
            document.getElementById("config").classList.add("hidden");
            document.getElementById(name).classList.remove("hidden");
        }

        function setActiveUser(id){
            window.activeUserId = id;
            EvidenceModule.setActiveUser(id);
        }

        function saveGistConfig(){
            const id = document.getElementById("gist-id").value;
            const token = document.getElementById("gist-token").value;
            EvidenceModule.openDB().then(() => {
                EvidenceModule.openDB().then(async () => {
                    await indexedDB.open("AsistenciasPRODB");
                });
            });
            alert("Configuración guardada.");
        }
    </script>

    <!-- MÓDULO DE EVIDENCIAS (el nuevo) -->
    <script src="./assets/js/evidence-module.js"></script>

    <!-- REGISTER SERVICE WORKER -->
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("./sw.js");
        }
    </script>

</body>
</html>